trigger:
  branches:
    include:
      - master
  tags:
    include:
      - '*-alpha*'
pr: none

pool:
  vmImage: 'ubuntu-latest'

strategy:
  matrix:
    ubuntu_gcc4:
      GCC_VERSION: 4
      containerImage: liambindle/penelope:0.1.0-ubuntu16.04-gcc4-netcdf4.5.0-netcdff4.4.4
    ubuntu_gcc5:
      GCC_VERSION: 5
      containerImage: liambindle/penelope:0.1.0-ubuntu16.04-gcc5-netcdf4.5.0-netcdff4.4.4
    ubuntu_gcc6:
      GCC_VERSION: 6
      containerImage: liambindle/penelope:0.1.0-ubuntu16.04-gcc6-netcdf4.5.0-netcdff4.4.4
    ubuntu_gcc7:
      GCC_VERSION: 7
      containerImage: liambindle/penelope:0.1.0-ubuntu16.04-gcc7-netcdf4.5.0-netcdff4.4.4
    ubuntu_gcc8:
      GCC_VERSION: 8
      containerImage: liambindle/penelope:0.1.0-ubuntu16.04-gcc8-netcdf4.5.0-netcdff4.4.4
    ubuntu_gcc9:
      GCC_VERSION: 9
      containerImage: liambindle/penelope:0.1.0-ubuntu16.04-gcc9-netcdf4.5.0-netcdff4.4.4
    ubuntu_netcdf_new:
      GCC_VERSION: 9
      containerImage: liambindle/penelope:0.1.0-ubuntu16.04-netcdf4.7.1-netcdff4.5.2
    ubuntu_netcdf_old:
      GCC_VERSION: 9
      containerImage: liambindle/penelope:0.1.0-ubuntu16.04-netcdf4.1.3
    centos_gcc4:
      GCC_VERSION: 4
      containerImage: liambindle/penelope:0.1.0-centos7-gcc4-netcdf4.5.0-netcdff4.4.4
    centos_gcc7:
      GCC_VERSION: 7
      containerImage: liambindle/penelope:0.1.0-centos7-gcc7-netcdf4.5.0-netcdff4.4.4
    centos_gcc8:
      GCC_VERSION: 8
      containerImage: liambindle/penelope:0.1.0-centos7-gcc8-netcdf4.5.0-netcdff4.4.4

container: $[ variables['containerImage'] ]

steps:
- script: |
    source /init.rc
    module load gcc/${GCC_VERSION}
    spack load hdf5 
    spack load netcdf 
    spack load netcdf-fortran
    mkdir build
    cd build
    cmake -DRUNDIR=IGNORE -DRUNDIR_SIM=standard $(Build.Repository.LocalPath)
    make -j
    make install
  displayName: 'Building GEOS-Chem'